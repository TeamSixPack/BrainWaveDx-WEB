<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>EEG 진단 결과</title>
</head>
<body>
<h2>EEG 진단 결과</h2>

<!-- result 가 있을 때만 결과 블럭 렌더 -->
<div th:if="${result != null}">
  <p><strong>Subject ID:</strong> <span th:text="${result['subject_id']}"></span></p>
  <p><strong>File Path:</strong> <span th:text="${result['file_path']}"></span></p>

  <p><strong>Segment Count:</strong> <span th:text="${result['n_segments']}"></span></p>
  <p><strong>Majority Label (segments):</strong> <span th:text="${result['segment_majority_label']}"></span></p>

  <p><strong>Subject Pred Label:</strong> <span th:text="${result['subject_pred_label']}"></span></p>
  <p><strong>True Label:</strong> <span th:text="${result['true_label']}"></span></p>
  <p><strong>Subject Accuracy (if GT):</strong> <span th:text="${result['subject_accuracy']}"></span></p>

  <h3>Subject-level Probabilities</h3>
  <ul>
    <!-- Map 순회: e 는 java.util.Map$Entry -->
    <li th:each="e : ${result['subject_probs']}">
      <span th:text="${e.key}"></span>: <span th:text="${e.value}"></span>
    </li>
  </ul>

  <h3>Segment Prob Mean</h3>
  <ul>
    <li th:each="e : ${result['prob_mean']}">
      <span th:text="${e.key}"></span>: <span th:text="${e.value}"></span>
    </li>
  </ul>

  <h3>Segment Counts (by predicted class)</h3>
  <ul>
    <li th:each="e : ${result['segment_counts']}">
      <span th:text="${e.key}"></span>: <span th:text="${e.value}"></span>
    </li>
  </ul>

  <h3>Channels Used</h3>
  <ul>
    <li th:each="ch : ${result['channels_used']}" th:text="${ch}"></li>
  </ul>

  <!-- channels_map 이 있을 때만 표시 (없으면 블럭 자체 미표시) -->
  <div th:if="${result['channels_map']} != null">
    <h3>Channel Mapping (target → picked)</h3>
    <ul>
      <li th:each="m : ${result['channels_map']}">
        <span th:text="${m['target']}"></span> → <span th:text="${m['picked']}"></span>
      </li>
    </ul>
  </div>

  <p><strong>Window:</strong>
    start=<span th:text="${result['window'] != null ? result['window']['start'] : ''}"></span>,
    need=<span th:text="${result['window'] != null ? result['window']['need'] : ''}"></span>
  </p>
</div>

<!-- result 가 없을 때 -->
<div th:if="${result == null}">
  <p>결과가 없습니다. <a href="/inferPage">진단을 다시 요청</a>하세요.</p>
  <p th:if="${error != null}" style="color:red" th:text="${error}"></p>
</div>

<p><a href="/inferPage">다시 요청하기</a></p>
</body>
</html>
